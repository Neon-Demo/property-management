sequenceDiagram
    actor Admin
    actor FieldUser
    participant ClientApp as Client Application
    participant APIServer as API Server
    participant AirtableAPI as Airtable API
    participant StorageS3 as S3 Storage
    participant AuthService as Auth Service (SSO)
    participant PDFService as PDF Generation Service
    participant NotifService as Notification Service
    participant GoogleCal as Google Calendar API

    %% Authentication Flow
    FieldUser->>ClientApp: Navigate to application
    ClientApp->>AuthService: Initiate SSO login
    AuthService-->>FieldUser: Present login options
    FieldUser->>AuthService: Authenticate with Google/Microsoft
    AuthService->>APIServer: Return auth token
    APIServer-->>ClientApp: Store JWT token
    APIServer->>NotifService: Get user notifications
    NotifService-->>ClientApp: Return notifications

    %% Job Assignment Flow
    Admin->>ClientApp: Create new job
    ClientApp->>APIServer: POST /jobs
    APIServer->>AirtableAPI: Create job record
    AirtableAPI-->>APIServer: Return job record
    APIServer->>GoogleCal: Create calendar event
    APIServer->>NotifService: Send assignment notification
    NotifService-->>FieldUser: Notify of new assignment
    APIServer-->>ClientApp: Return job details
    ClientApp-->>Admin: Display job confirmation

    %% Form Completion Flow (with offline support)
    FieldUser->>ClientApp: Open assigned job
    ClientApp->>APIServer: GET /jobs/{jobId}
    APIServer-->>ClientApp: Return job details
    ClientApp->>APIServer: GET /forms/templates
    APIServer-->>ClientApp: Return required form templates
    Note over ClientApp: Store forms locally
    Note over FieldUser,ClientApp: User goes offline
    FieldUser->>ClientApp: Fill out inspection form
    Note over ClientApp: Store in IndexedDB
    FieldUser->>ClientApp: Take photos
    Note over ClientApp: Store photos locally
    Note over FieldUser,ClientApp: User comes back online
    ClientApp->>APIServer: POST /forms
    APIServer->>AirtableAPI: Create form record
    APIServer-->>ClientApp: Return form ID
    ClientApp->>APIServer: POST /forms/{formId}/attachments
    ClientApp->>StorageS3: Upload photos
    StorageS3-->>APIServer: Return file URLs
    APIServer->>AirtableAPI: Update form with attachments
    ClientApp->>APIServer: POST /forms/{formId}/submit
    APIServer->>AirtableAPI: Update form status
    APIServer->>NotifService: Send completion notification
    NotifService-->>Admin: Notify form completion

    %% Report Generation Flow
    Admin->>ClientApp: Generate report
    ClientApp->>APIServer: POST /reports
    APIServer->>AirtableAPI: Get form data
    AirtableAPI-->>APIServer: Return form data
    APIServer->>PDFService: Generate PDF report
    PDFService-->>APIServer: Return generated PDF
    APIServer->>StorageS3: Store PDF file
    StorageS3-->>APIServer: Return file URL
    APIServer->>AirtableAPI: Create report record
    APIServer-->>ClientApp: Return report details
    ClientApp-->>Admin: Display report preview
    Admin->>ClientApp: Approve report
    ClientApp->>APIServer: POST /reports/{reportId}/approve
    APIServer->>AirtableAPI: Update report status
    APIServer->>NotifService: Send report notification
    NotifService-->>FieldUser: Notify report completion
